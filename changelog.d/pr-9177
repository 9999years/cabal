synopsis: Enable recompilation avoidance during Haddock generation
packages: cabal-install
prs: #9177
issues: #9175

description: {

* Haddock no longer writes compilation files by default, so we do not need to
  pass tmp dirs for `-hidir`, `-stubdir`, and `-odir` via `--optghc`. Indeed, we
  do not *want* to do so, since it results in recompilation for every invocation
  of Haddock via Cabal. We now stop this from happening for Haddock versions
  2.28 and greater, since that is when Hi Haddock was introduced.

* We no longer define the `__HADDOCK_VERSION__` macro when invoking GHC through
  Haddock, since doing so essentially guarantees recompilation during
  documentation generation. Since a very limited set of users may still rely on
  this flag, we introduce the `--haddock-version-cpp` flag and
  `haddock-version-cpp:` cabal.project field, which enables the definition of
  the `__HADDOCK_VERSION__` macro when invoking GHC through Haddock.

* Rename the `--haddock-lib` flag to `--haddock-resources-dir` (and
  `haddock-lib:` cabal.project field to `haddock-resources-dir:`), and add this
  flag to the users guide since it was missing an entry.

* `documentation: true` or `--enable-documentation` now implies `-haddock` for
  GHC.

}
